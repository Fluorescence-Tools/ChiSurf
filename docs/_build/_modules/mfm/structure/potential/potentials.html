

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mfm.structure.potential.potentials &mdash; ChiSurf  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> ChiSurf
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_documentation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_documentation/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_documentation/tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_documentation/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_documentation/use_cases.html">Use cases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ChiSurf</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>mfm.structure.potential.potentials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mfm.structure.potential.potentials</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="kn">import</span> <span class="nn">mfm.fluorescence</span>
<span class="kn">from</span> <span class="nn">mfm.fluorescence.fps</span> <span class="k">import</span> <span class="n">BasicAV</span>
<span class="kn">from</span> <span class="nn">mfm.structure.structure</span> <span class="k">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">mfm.structure.potential</span> <span class="k">import</span> <span class="n">cPotentials</span>
<span class="kn">import</span> <span class="nn">mfm.widgets</span>
<span class="kn">import</span> <span class="nn">mfm</span>


<div class="viewcode-block" id="centroid2"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.centroid2">[docs]</a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">centroid2</span><span class="p">(</span>
        <span class="n">atom_lookup</span><span class="p">,</span>
        <span class="n">res_types</span><span class="p">,</span>
        <span class="n">ca_dist</span><span class="p">,</span>
        <span class="n">r</span><span class="p">,</span>
        <span class="n">potential</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.5</span><span class="p">,</span>
        <span class="n">centroid_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.5</span><span class="p">,</span>
        <span class="n">max_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">19.0</span><span class="p">,</span>
        <span class="n">bin_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">repulsion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the potential energy given the UNRES GBV-Sidechain potential and isotropic conditions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_lookup : integer array</span>
<span class="sd">            A two dimensional lookup array to find for each residue and atom-type the corresponding</span>
<span class="sd">            position within the coordinate array `r`.</span>
<span class="sd">    centroid_pos : integer</span>
<span class="sd">            This variable specifies which position in the atom_lookup contains the number of the C-beta</span>
<span class="sd">            atom.</span>
<span class="sd">    res_types : integer array</span>
<span class="sd">            An array containing the residue types of the residues as a one dimensional array. The residue types</span>
<span class="sd">            are in the order as in :py:const:mfm.structure.residue_atoms_internal:</span>
<span class="sd">    ca_dist : double array</span>
<span class="sd">            The array `ca_dist` should contain the pair-wise distances of all C-alpha atoms of the protein</span>
<span class="sd">    r : double array</span>
<span class="sd">            The two-dimensional array `r` contains all Cartesian coordinates of all atoms.</span>
<span class="sd">    potential : double array</span>
<span class="sd">            This 3-dimensional array contains pre-calculated potentials of all possible combinations of amino-</span>
<span class="sd">            acids. potential[1,2,10] has to contain the potential of the amino-acid (1) and (2) at a distance</span>
<span class="sd">            of 10 whereas the actual distance is dependent on the range in which the potential was actually</span>
<span class="sd">            calculated. The potential can be calculated with the small program located in:</span>
<span class="sd">            mfm.structure.potential.database.make_unres_lookup.py</span>
<span class="sd">    min_dist : double</span>
<span class="sd">            The minimum distance for which the parameter `potential` was calculated. This parameter has to be</span>
<span class="sd">            supplied and depends on the provided pre-calculated potential file.</span>
<span class="sd">    max_dist :double</span>
<span class="sd">            The minimum distance for which the parameter `potential` was calculated (see min_dist)</span>
<span class="sd">    bin_width : double</span>
<span class="sd">            The spacing between the bin of the distance points in the pre-calculated potential</span>
<span class="sd">    cutoff : double</span>
<span class="sd">            Distances between the centroids bigger than the cut-off distance will be neglected</span>

<span class="sd">    Citation</span>
<span class="sd">    --------</span>
<span class="sd">    J. Comp. Chem. Vol. 18, 7, 849-873, 1997</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nRes</span> <span class="o">=</span> <span class="n">atom_lookup</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">E</span><span class="p">,</span> <span class="n">nCont</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">residue_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRes</span><span class="p">):</span>
        <span class="n">c_beta_atom_nbr_i</span> <span class="o">=</span> <span class="n">atom_lookup</span><span class="p">[</span><span class="n">residue_i</span><span class="p">,</span> <span class="n">centroid_pos</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c_beta_atom_nbr_i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># no side-chain -&gt; next</span>
            <span class="k">continue</span>

        <span class="n">residue_type_i</span> <span class="o">=</span> <span class="n">res_types</span><span class="p">[</span><span class="n">residue_i</span><span class="p">]</span>

        <span class="n">xi</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">c_beta_atom_nbr_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">c_beta_atom_nbr_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">zi</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">c_beta_atom_nbr_i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">residue_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">residue_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nRes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">c_beta_atom_nbr_j</span> <span class="o">=</span> <span class="n">atom_lookup</span><span class="p">[</span><span class="n">residue_j</span><span class="p">,</span> <span class="n">centroid_pos</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c_beta_atom_nbr_j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ca_dist</span><span class="p">[</span><span class="n">residue_i</span><span class="p">,</span> <span class="n">residue_j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cutoff</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">nCont</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">residue_type_j</span> <span class="o">=</span> <span class="n">res_types</span><span class="p">[</span><span class="n">residue_j</span><span class="p">]</span>

            <span class="n">xj</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">c_beta_atom_nbr_j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yj</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">c_beta_atom_nbr_j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">zj</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">c_beta_atom_nbr_j</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">dij</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xi</span><span class="o">-</span><span class="n">xj</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yi</span><span class="o">-</span><span class="n">yj</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zi</span><span class="o">-</span><span class="n">zj</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span>
                <span class="n">E</span> <span class="o">+=</span> <span class="n">repulsion</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dij</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">)</span>
                <span class="n">bin_nbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dij</span> <span class="o">/</span> <span class="n">bin_width</span><span class="p">)</span>
                <span class="n">E</span> <span class="o">+=</span> <span class="n">potential</span><span class="p">[</span><span class="n">residue_type_i</span><span class="p">,</span> <span class="n">residue_type_j</span><span class="p">,</span> <span class="n">bin_nbr</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">nCont</span><span class="p">,</span> <span class="n">E</span></div>


<div class="viewcode-block" id="internal_potential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.internal_potential">[docs]</a><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">internal_potential</span><span class="p">(</span>
        <span class="n">internal_coordinates</span><span class="p">,</span>
        <span class="n">equilibrium_internal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">k_bond</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">k_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">k_dihedral</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Simple potential based internal coordinates for C-alpha bead model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">equilibrium_internal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">k_bond</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bond</span> <span class="o">=</span> <span class="n">k_bond</span> <span class="o">*</span> <span class="p">(</span><span class="n">internal_coordinates</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">equilibrium_internal</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="n">bond</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">k_angle</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">k_angle</span> <span class="o">*</span> <span class="p">(</span><span class="n">internal_coordinates</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">equilibrium_internal</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="n">angle</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">k_dihedral</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dihedral</span> <span class="o">=</span> <span class="n">k_dihedral</span> <span class="o">*</span> <span class="p">(</span><span class="n">internal_coordinates</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">equilibrium_internal</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="n">dihedral</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">e</span></div>


<div class="viewcode-block" id="internal_potential_calpha"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.internal_potential_calpha">[docs]</a><span class="k">def</span> <span class="nf">internal_potential_calpha</span><span class="p">(</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculates a *internal* potential based on the similarity of the bonds length, angles, and dihedrals</span>
<span class="sd">    to a reference structure.</span>

<span class="sd">    :param structure:</span>
<span class="sd">    :param kwargs:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;equilibrium_internal&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k_bonds&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ka</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k_angle&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">kd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k_dihedral&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">internal_potential</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">internal_coordinates</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">ka</span><span class="p">,</span> <span class="n">kd</span><span class="p">)</span></div>


<div class="viewcode-block" id="lj_calpha"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.lj_calpha">[docs]</a><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">lj_calpha</span><span class="p">(</span>
        <span class="n">ca_coordinates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">rm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.8208650279</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Truncated Lennard Jones</span>

<span class="sd">    :param ca_coordinates:</span>
<span class="sd">    :param epsilon:</span>
<span class="sd">    :param rm:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># total energy</span>
    <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">ca_coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rm2</span> <span class="o">=</span> <span class="n">rm</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
        <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">,</span> <span class="n">z_i</span> <span class="o">=</span> <span class="n">ca_coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">):</span>
            <span class="n">x_j</span><span class="p">,</span> <span class="n">y_j</span><span class="p">,</span> <span class="n">z_j</span> <span class="o">=</span> <span class="n">ca_coordinates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_i</span> <span class="o">-</span> <span class="n">x_j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_i</span> <span class="o">-</span> <span class="n">y_j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_i</span> <span class="o">-</span> <span class="n">z_j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="p">(</span><span class="n">rm2</span> <span class="o">/</span> <span class="n">r2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="n">sr</span> <span class="o">*</span> <span class="p">(</span><span class="n">sr</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">energy</span></div>


<div class="viewcode-block" id="lennard_jones_calpha"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.lennard_jones_calpha">[docs]</a><span class="k">def</span> <span class="nf">lennard_jones_calpha</span><span class="p">(</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
        <span class="n">rm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.8208650279</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param structure: a structure object</span>
<span class="sd">    :param rm: is the C-alpha equilibrium distance</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_atom_index_by_name</span><span class="p">(</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">ca_atoms</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lj_calpha</span><span class="p">(</span><span class="n">ca_atoms</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rm</span><span class="p">)</span></div>


<div class="viewcode-block" id="gb"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.gb">[docs]</a><span class="nd">@nb</span><span class="o">.</span><span class="n">njit</span>
<span class="k">def</span> <span class="nf">gb</span><span class="p">(</span>
        <span class="n">xyz</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
        <span class="n">epsilon0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">80.1</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized Born http://en.wikipedia.org/wiki/Implicit_solvation</span>
<span class="sd">    with cutoff-potential potential shifted by value at cutoff to smooth the energy</span>
<span class="sd">    :param xyz: atom-list</span>
<span class="sd">    :param epsilon: dielectric constant of proteins: 2-40</span>
<span class="sd">    :param epsilon0: dielectric constant of water 80.1</span>
<span class="sd">    :param cutoff: cutoff-distance in Angstrom</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nAtoms</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cutoff2</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">]</span>
    <span class="n">a_radii</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
    <span class="n">a_charge</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span>
    <span class="n">pre</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mf">3.14159265359</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">epsilon0</span> <span class="o">-</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span>

    <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nAtoms</span><span class="p">):</span>
        <span class="n">qi</span> <span class="o">=</span> <span class="n">a_charge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">qi</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">r1x</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">r1y</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r1z</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">a_radii</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nAtoms</span><span class="p">):</span>
            <span class="n">qj</span> <span class="o">=</span> <span class="n">a_charge</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">qj</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">r2x</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">r2y</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">r2z</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">aj</span> <span class="o">=</span> <span class="n">a_radii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">rij2</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1x</span> <span class="o">-</span> <span class="n">r2x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r1x</span> <span class="o">-</span> <span class="n">r2x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r1y</span> <span class="o">-</span> <span class="n">r2y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r1y</span> <span class="o">-</span> <span class="n">r2y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r1z</span> <span class="o">-</span> <span class="n">r2z</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r1z</span> <span class="o">-</span> <span class="n">r2z</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rij2</span> <span class="o">&gt;</span> <span class="n">cutoff2</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aij2</span> <span class="o">=</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">aj</span>
                <span class="n">qij</span> <span class="o">=</span> <span class="n">qi</span> <span class="o">*</span> <span class="n">qj</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">rij2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">aij2</span><span class="p">)</span>
                <span class="n">fgbr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rij2</span> <span class="o">+</span> <span class="n">aij2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">D</span><span class="p">))</span>
                <span class="n">fgbc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cutoff</span> <span class="o">+</span> <span class="n">aij2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">D</span><span class="p">))</span>
                <span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span> <span class="o">+</span> <span class="n">qij</span> <span class="o">/</span> <span class="n">fgbr</span> <span class="o">-</span> <span class="n">qij</span><span class="o">/</span><span class="n">fgbc</span>
    <span class="k">return</span> <span class="n">energy</span> <span class="o">*</span> <span class="n">pre</span></div>


<div class="viewcode-block" id="go"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.go">[docs]</a><span class="nd">@nb</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">go</span><span class="p">(</span>
        <span class="n">ca_dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">energy_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">rm_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If cutoff is True the LJ-Potential is cutoff and shifted at 2.5 sigma</span>

<span class="sd">    :param resLookUp:</span>
<span class="sd">    :param ca_dist:</span>
<span class="sd">    :param energy_matrix:</span>
<span class="sd">    :param rm_matrix:</span>
<span class="sd">    :param cutoff:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># total energy</span>
    <span class="n">n_residues</span> <span class="o">=</span> <span class="n">ca_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_residues</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_residues</span><span class="p">):</span>
            <span class="n">epsilon</span> <span class="o">=</span> <span class="n">energy_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">rm</span> <span class="o">=</span> <span class="n">rm_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">ca_dist</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rm</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rm</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">:</span>
                <span class="n">sr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">rm</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">**</span> <span class="mi">6</span>
                <span class="n">tmp</span> <span class="o">-=</span> <span class="n">sr</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="n">sr</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">4.0</span>
                <span class="n">tmp</span> <span class="o">*=</span> <span class="n">epsilon</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="mf">0.00818</span> <span class="o">*</span> <span class="n">epsilon</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span> <span class="n">epsilon</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">energy</span></div>


<div class="viewcode-block" id="Ramachandran"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.Ramachandran">[docs]</a><span class="k">class</span> <span class="nc">Ramachandran</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./mfm/structure/potential/database/rama_ala_pro_gly.npy&#39;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param filename:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;rama&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramaPot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="Ramachandran.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.Ramachandran.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">Erama</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">ramaEnergy</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">residue_lookup_i</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">iAtoms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramaPot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Erama</span>
        <span class="k">return</span> <span class="n">Erama</span></div></div>


<div class="viewcode-block" id="Electrostatics"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.Electrostatics">[docs]</a><span class="k">class</span> <span class="nc">Electrostatics</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gb&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param type:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ele&#39;</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;gb&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">gb</span>

<div class="viewcode-block" id="Electrostatics.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.Electrostatics.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="c1">#Eel = cPotentials.gb(structure.xyz)</span>
        <span class="n">Eel</span> <span class="o">=</span> <span class="n">gb</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Eel</span>
        <span class="k">return</span> <span class="n">Eel</span></div></div>


<div class="viewcode-block" id="LJ_Bead"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.LJ_Bead">[docs]</a><span class="k">class</span> <span class="nc">LJ_Bead</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;LJ_bead&#39;</span>

<div class="viewcode-block" id="LJ_Bead.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.LJ_Bead.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">lennard_jones_calpha</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span></div></div>


<div class="viewcode-block" id="HPotential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.HPotential">[docs]</a><span class="k">class</span> <span class="nc">HPotential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;H-Bond&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
            <span class="n">cutoff_ca</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
            <span class="n">cutoff_hbond</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoffH</span> <span class="o">=</span> <span class="n">cutoff_hbond</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoffCA</span> <span class="o">=</span> <span class="n">cutoff_ca</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;potential&#39;</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;./database/hb.csv&#39;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;oh&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateParameter</span><span class="p">()</span>

<div class="viewcode-block" id="HPotential.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.HPotential.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">cca2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoffCA</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">ch2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoffH</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">nHbond</span><span class="p">,</span> <span class="n">Ehbond</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">hBondLookUpAll</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">l_res</span><span class="p">,</span> <span class="n">s1</span><span class="o">.</span><span class="n">dist_ca</span><span class="p">,</span> <span class="n">s1</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hPot</span><span class="p">,</span> <span class="n">cca2</span><span class="p">,</span> <span class="n">ch2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Ehbond</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nHbond</span> <span class="o">=</span> <span class="n">nHbond</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span></div>

<div class="viewcode-block" id="HPotential.getNbrBonds"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.HPotential.getNbrBonds">[docs]</a>    <span class="k">def</span> <span class="nf">getNbrBonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nHbond</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nHbond</span></div>

<div class="viewcode-block" id="HPotential.updateParameter"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.HPotential.updateParameter">[docs]</a>    <span class="k">def</span> <span class="nf">updateParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hPot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hPot</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oh</span><span class="p">:</span>
            <span class="n">hPot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on</span><span class="p">:</span>
            <span class="n">hPot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn</span><span class="p">:</span>
            <span class="n">hPot</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">:</span>
            <span class="n">hPot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hPot</span> <span class="o">=</span> <span class="n">hPot</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hPot</span>

    <span class="nd">@potential</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hPot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hPot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hPot</span></div>


<div class="viewcode-block" id="GoPotential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential">[docs]</a><span class="k">class</span> <span class="nc">GoPotential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;go&#39;</span>

<div class="viewcode-block" id="GoPotential.setGo"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.setGo">[docs]</a>    <span class="k">def</span> <span class="nf">setGo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">nnEFactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnEFactor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_native_contact_on</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">native_cutoff_on</span> <span class="k">else</span> <span class="mf">1e6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sMatrix</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">go_init</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">residue_lookup_r</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dist_ca</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">nnEFactor</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span></div>

<div class="viewcode-block" id="GoPotential.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">Etot</span><span class="p">,</span> <span class="n">nNa</span><span class="p">,</span> <span class="n">Ena</span><span class="p">,</span> <span class="n">nNN</span><span class="p">,</span> <span class="n">Enn</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">residue_lookup_r</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dist_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sMatrix</span><span class="p">)</span>
        <span class="c1">#Etot = go(c., c.dist_ca, self.eMatrix, self.sMatrix)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Etot</span>
        <span class="k">return</span> <span class="n">Etot</span></div>

<div class="viewcode-block" id="GoPotential.getNbrNonNative"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.getNbrNonNative">[docs]</a>    <span class="k">def</span> <span class="nf">getNbrNonNative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nNN</span></div>

<div class="viewcode-block" id="GoPotential.getNbrNative"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.getNbrNative">[docs]</a>    <span class="k">def</span> <span class="nf">getNbrNative</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nNa</span></div>

<div class="viewcode-block" id="GoPotential.set_sMatrix"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.set_sMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">set_sMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sMatrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sMatrix</span> <span class="o">=</span> <span class="n">sMatrix</span></div>

<div class="viewcode-block" id="GoPotential.set_eMatrix"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.set_eMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">set_eMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eMatrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eMatrix</span> <span class="o">=</span> <span class="n">eMatrix</span></div>

<div class="viewcode-block" id="GoPotential.set_nMatrix"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.GoPotential.set_nMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">set_nMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nMatrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMatrix</span> <span class="o">=</span> <span class="n">nMatrix</span></div></div>


<div class="viewcode-block" id="MJPotential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.MJPotential">[docs]</a><span class="k">class</span> <span class="nc">MJPotential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Miyazawa-Jernigan&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ca_cutcoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.5</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;.database/mj.csv&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ca_cutoff</span> <span class="o">=</span> <span class="n">ca_cutcoff</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mjPot</span>

    <span class="nd">@potential</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mjPot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<div class="viewcode-block" id="MJPotential.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.MJPotential.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">nCont</span><span class="p">,</span> <span class="n">Emj</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">mj</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l_res</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">residue_types</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dist_ca</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mjPot</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ca_cutoff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Emj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nCont</span> <span class="o">=</span> <span class="n">nCont</span>
        <span class="k">return</span> <span class="n">Emj</span></div>

<div class="viewcode-block" id="MJPotential.getNbrContacts"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.MJPotential.getNbrContacts">[docs]</a>    <span class="k">def</span> <span class="nf">getNbrContacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nCont</span></div></div>


<div class="viewcode-block" id="CEPotential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.CEPotential">[docs]</a><span class="k">class</span> <span class="nc">CEPotential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import mfm.structure</span>
<span class="sd">    &gt;&gt;&gt; import mfm.structure.potential</span>

<span class="sd">    &gt;&gt;&gt; s = mfm..structure.structure.Structure(&#39;./sample_data/model/hgbp1/hGBP1_closed.pdb&#39;, verbose=True, make_coarse=True)</span>
<span class="sd">    &gt;&gt;&gt; pce = mfm.structure.potential.potentials.CEPotential(s, ca_cutoff=64.0)</span>
<span class="sd">    &gt;&gt;&gt; pce.getEnergy()</span>
<span class="sd">    -0.15896629131635745</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Iso-UNRES&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
            <span class="n">potential</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        scaling_factor : factor to scale energies from kCal/mol to kT=1.0 at 298K</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scaling_factor</span> <span class="o">=</span> <span class="mf">0.593</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ca_cutoff</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ca_cutoff&#39;</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">potential</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">potential</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;.database/unres.npy&#39;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">scaling_factor</span>
        <span class="c1"># the number of the atom in the lookup table</span>
        <span class="c1"># (4=C-beta, 1=C-alpha, see: mfm.structure.protein internal_atom_numbers)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroid_number</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;centroid_number&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repulsion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;repulsion&#39;</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_dist&#39;</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_dist&#39;</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bin_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bin_width&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span>

    <span class="nd">@potential</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">v</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<div class="viewcode-block" id="CEPotential.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.CEPotential.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="k">if</span> <span class="n">cutoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca_cutoff</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">dist_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">dist_ca</span><span class="p">)</span>
        <span class="n">residue_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">residue_types</span><span class="p">)</span>
        <span class="n">l_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l_res</span><span class="p">)</span>
        <span class="n">centroid_pos</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;centroid_number&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_number</span><span class="p">)</span>
        <span class="n">repulsion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;repulsion&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repulsion</span><span class="p">)</span>
        <span class="n">min_dist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_dist&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_dist</span><span class="p">)</span>
        <span class="n">nCont</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">centroid2</span><span class="p">(</span><span class="n">l_res</span><span class="p">,</span> <span class="n">residue_types</span><span class="p">,</span> <span class="n">dist_ca</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">potential</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
                             <span class="n">centroid_pos</span><span class="o">=</span><span class="n">centroid_pos</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span>
                             <span class="n">max_dist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="p">,</span> <span class="n">bin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin_width</span><span class="p">,</span>
                             <span class="n">repulsion</span><span class="o">=</span><span class="n">repulsion</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nCont</span> <span class="o">=</span> <span class="n">nCont</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">)</span></div>

<div class="viewcode-block" id="CEPotential.getNbrContacts"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.CEPotential.getNbrContacts">[docs]</a>    <span class="k">def</span> <span class="nf">getNbrContacts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nCont</span></div></div>


<div class="viewcode-block" id="ASA"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.ASA">[docs]</a><span class="k">class</span> <span class="nc">ASA</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Asa-Ca&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span>
            <span class="n">probe</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">n_sphere_point</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">590</span><span class="p">,</span>
            <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ASA</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">probe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sphere_point</span> <span class="o">=</span> <span class="n">n_sphere_point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sphere_points</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">spherePoints</span><span class="p">(</span><span class="n">n_sphere_point</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>

<div class="viewcode-block" id="ASA.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.ASA.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="c1">#def asa(double[:, :] xyz, int[:, :] resLookUp, double[:, :] caDist, double[:, :] sphere_points,</span>
        <span class="c1">#double probe=1.0, double radius = 2.5, char sum=1)</span>
        <span class="n">asa</span> <span class="o">=</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">asa</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">l_res</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dist_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphere_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">asa</span></div></div>


<div class="viewcode-block" id="ClashPotential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.ClashPotential">[docs]</a><span class="k">class</span> <span class="nc">ClashPotential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Clash-Potential&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">clash_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="n">covalent_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">        :return:</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import mfm.structure</span>
<span class="sd">        &gt;&gt;&gt; import mfm.structure.potential</span>

<span class="sd">        &gt;&gt;&gt; s = mfm.structure.structure.Structure(&#39;./sample_data/model/hgbp1/hGBP1_closed.pdb&#39;, verbose=True, make_coarse=True)</span>
<span class="sd">        &gt;&gt;&gt; pce = mfm.structure.potential.potentials.ClashPotential(structure=s, clash_tolerance=6.0)</span>
<span class="sd">        &gt;&gt;&gt; pce.getEnergy()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clash_tolerance</span> <span class="o">=</span> <span class="n">clash_tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covalent_radius</span> <span class="o">=</span> <span class="n">covalent_radius</span>

<div class="viewcode-block" id="ClashPotential.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.ClashPotential.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="k">return</span> <span class="n">cPotentials</span><span class="o">.</span><span class="n">clash_potential</span><span class="p">(</span>
            <span class="n">c</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span>
            <span class="n">c</span><span class="o">.</span><span class="n">vdw</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clash_tolerance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covalent_radius</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="AvPotential"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.AvPotential">[docs]</a><span class="k">class</span> <span class="nc">AvPotential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The AvPotential class provides the possibility to calculate the reduced or unreduced chi2 given a set of</span>
<span class="sd">    labeling positions and experimental distances. Here the labeling positions and distances are provided as</span>
<span class="sd">    dictionaries.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import json</span>
<span class="sd">    &gt;&gt;&gt; labeling_file = &#39;./sample_data/model/labeling.json&#39;</span>
<span class="sd">    &gt;&gt;&gt; labeling = json.load(open(labeling_file, &#39;r&#39;))</span>
<span class="sd">    &gt;&gt;&gt; distances = labeling[&#39;Distances&#39;]</span>
<span class="sd">    &gt;&gt;&gt; positions = labeling[&#39;Positions&#39;]</span>
<span class="sd">    &gt;&gt;&gt; import mfm</span>
<span class="sd">    &gt;&gt;&gt; av_potential = mfm.structure.potential.potentials.AvPotential(distances=distances, positions=positions)</span>
<span class="sd">    &gt;&gt;&gt; structure = mfm.structure.structure.Structure(&#39;/sample_data/model/HM_1FN5_Naming.pdb&#39;)</span>
<span class="sd">    &gt;&gt;&gt; av_potential.getChi2(structure)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Av&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labeling_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">rda_axis</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">av_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">min_av</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labeling_file</span> <span class="o">=</span> <span class="n">labeling_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="k">if</span> <span class="n">rda_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rda_axis</span> <span class="o">=</span> <span class="n">mfm</span><span class="o">.</span><span class="n">fluorescence</span><span class="o">.</span><span class="n">rda_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rda_axis</span> <span class="o">=</span> <span class="n">rda_axis</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Distances&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Positions&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">av_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">av_samples</span> <span class="o">=</span> <span class="n">mfm</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fps&quot;</span><span class="p">][</span><span class="s2">&quot;distance_samples&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_av_samples</span> <span class="o">=</span> <span class="n">av_samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_av</span> <span class="o">=</span> <span class="n">min_av</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">avs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labeling_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labeling_file</span>

    <span class="nd">@labeling_file</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">labeling_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labeling_file</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Distances&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;Positions&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Structure object used for the calculation of the accessible volumes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span>

    <span class="nd">@structure</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_avs</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chi2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The current unreduced chi2 (recalculated at each call)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChi2</span><span class="p">()</span>

<div class="viewcode-block" id="AvPotential.calc_avs"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.AvPotential.calc_avs">[docs]</a>    <span class="k">def</span> <span class="nf">calc_avs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates/recalculates the accessible volumes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The structure is not set&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Positions not set unable to calculate AVs&quot;</span><span class="p">)</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;structure&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,},</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">position_key</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">position_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span>
        <span class="p">]</span>
        <span class="n">avs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">BasicAV</span><span class="p">(</span><span class="o">**</span><span class="n">x</span><span class="p">),</span> <span class="n">arguments</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">position_key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">[</span><span class="n">position_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">avs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="AvPotential.calc_distances"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.AvPotential.calc_distances">[docs]</a>    <span class="k">def</span> <span class="nf">calc_distances</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param structure: Structure</span>
<span class="sd">            If this object is provided the attributes regarding dye-attachment are kept constant</span>
<span class="sd">            and the structure is changed prior calculation of the distances.</span>
<span class="sd">        :param verbose: bool</span>
<span class="sd">            If this is True output to stdout is generated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">for</span> <span class="n">distance_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">distance_key</span><span class="p">]</span>
            <span class="n">av1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">[</span><span class="n">distance</span><span class="p">[</span><span class="s1">&#39;position1_name&#39;</span><span class="p">]]</span>
            <span class="n">av2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avs</span><span class="p">[</span><span class="n">distance</span><span class="p">[</span><span class="s1">&#39;position2_name&#39;</span><span class="p">]]</span>
            <span class="n">distance_type</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;distance_type&#39;</span><span class="p">]</span>
            <span class="n">R0</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;Forster_radius&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">distance_type</span> <span class="o">==</span> <span class="s1">&#39;RDAMean&#39;</span><span class="p">:</span>
                <span class="n">d12</span> <span class="o">=</span> <span class="n">av1</span><span class="o">.</span><span class="n">dRDA</span><span class="p">(</span><span class="n">av2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">distance_type</span> <span class="o">==</span> <span class="s1">&#39;Rmp&#39;</span><span class="p">:</span>
                <span class="n">d12</span> <span class="o">=</span> <span class="n">av1</span><span class="o">.</span><span class="n">dRmp</span><span class="p">(</span><span class="n">av1</span><span class="p">,</span> <span class="n">av2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">distance_type</span> <span class="o">==</span> <span class="s1">&#39;RDAMeanE&#39;</span><span class="p">:</span>
                <span class="n">d12</span> <span class="o">=</span> <span class="n">av1</span><span class="o">.</span><span class="n">RDAE</span><span class="p">(</span><span class="n">av1</span><span class="p">,</span> <span class="n">av2</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
            <span class="c1">#elif distance_type == &#39;pRDA&#39;:</span>
            <span class="c1">#    rda = np.array(distance[&#39;rda&#39;])</span>
            <span class="c1">#    d12 = functions.histogram_rda(av1, av2, rda_axis=rda)[0]</span>
            <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;model_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d12</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distance: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">distance_key</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Forster-Radius </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;Forster_radius&#39;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distance type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">distance_type</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model distance: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d12</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experimental distance: </span><span class="si">%.1f</span><span class="s2"> (-</span><span class="si">%.1f</span><span class="s2">, +</span><span class="si">%.1f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">distance</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span>
                                                                      <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;error_neg&#39;</span><span class="p">],</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;error_pos&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="AvPotential.getChi2"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.AvPotential.getChi2">[docs]</a>    <span class="k">def</span> <span class="nf">getChi2</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">reduced</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param structure: Structure</span>
<span class="sd">            A Structure object if provided the attributes regarding dye-attachment are kept constant</span>
<span class="sd">            and the structure is changed prior calculation of the distances.</span>
<span class="sd">        :param reduced: bool</span>
<span class="sd">            If True the reduced chi2 is calculated (by default False)</span>
<span class="sd">        :param verbose: bool</span>
<span class="sd">            Output to stdout</span>
<span class="sd">        :return: A float containig the chi2 (reduced or unreduced) of the current or provided structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>

        <span class="n">chi2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_distances</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">dm</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;model_distance&#39;</span><span class="p">]</span>
            <span class="n">de</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;distance_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;pRDA&#39;</span><span class="p">:</span>
                <span class="n">prda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distance</span><span class="p">[</span><span class="s1">&#39;prda&#39;</span><span class="p">])</span>
                <span class="n">prda</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prda</span><span class="p">)</span>
                <span class="n">chi2</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">dm</span> <span class="o">-</span> <span class="n">prda</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error_neg</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;error_neg&#39;</span><span class="p">]</span>
                <span class="n">error_pos</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;error_pos&#39;</span><span class="p">]</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">dm</span> <span class="o">-</span> <span class="n">de</span>
                <span class="n">chi2</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="n">error_neg</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="n">error_pos</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">reduced</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chi2</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">chi2</span></div>

<div class="viewcode-block" id="AvPotential.getEnergy"><a class="viewcode-back" href="../../../../api/mfm.structure.potential.html#mfm.structure.potential.potentials.AvPotential.getEnergy">[docs]</a>    <span class="k">def</span> <span class="nf">getEnergy</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">:</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">gauss_bond</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">mfm</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">if</span> <span class="n">gauss_bond</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_distances</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;model_distance&#39;</span><span class="p">]</span>
                <span class="n">de</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span>
                <span class="n">error_neg</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;error_neg&#39;</span><span class="p">]</span>
                <span class="n">error_pos</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="s1">&#39;error_pos&#39;</span><span class="p">]</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">error_neg</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm</span> <span class="o">-</span> <span class="n">de</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">error_pos</span>
                <span class="n">energy</span> <span class="o">-=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">de</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">energy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChi2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span></div></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Thomas Peulen

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>